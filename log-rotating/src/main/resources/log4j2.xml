<?xml version="1.0" encoding="UTF-8"?>
<Configuration status="INFO">

	<Properties>
		<Property name="LOG_DIR">logs</Property>
		<Property name="MAX_SIZE">256KB</Property>
		<Property name="APP_MAX_FILES">2</Property>
		<Property name="ERROR_MAX_FILES">3</Property>
		<Property name="AUDIT_MAX_FILES">4</Property>

		<!-- naming pattern -->
		<Property name="APP_PATTERN">${LOG_DIR}/app/archived/app-%d{yyyy-MM-dd_HH-mm}.%i.log.gz</Property>

		<Property name="ERROR_PATTERN">${LOG_DIR}/error/archived/error-%d{yyyy-MM-dd_HH-mm}.%i.log.gz
		</Property>
		<Property name="AUDIT_PATTERN">${LOG_DIR}/audit/archived/audit-%d{yyyy-MM-dd_HH-mm}.%i.log.gz
		</Property>
	</Properties>

	<Appenders>

		<!-- INFO/DEBUG -->
		<Console name="Console" target="SYSTEM_OUT">
			<PatternLayout
				pattern="%d{HH:mm:ss.SSS} [%t] %-5level %c - %msg%n" />
		</Console>

		<RollingFile name="APP_FILE" createOnDemand="true"
			fileName="${LOG_DIR}/app/app.log" filePattern="${APP_PATTERN}">

			<PatternLayout
				pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %c - %msg%n" />

			<Policies>
				<SizeBasedTriggeringPolicy
					size="${MAX_SIZE}" />
			</Policies>


			<!-- WARN 이상만 통과 -->
			<Filters>
				<ThresholdFilter level="WARN" onMatch="DENY"
					onMismatch="NEUTRAL" />
			</Filters>

			<DefaultRolloverStrategy fileIndex="min">
				<Delete basePath="${LOG_DIR}/app/archived" maxDepth="1">
					<IfFileName glob="app-*.log.gz" />
					<IfAccumulatedFileCount
						exceeds="${APP_MAX_FILES}" />
				</Delete>
			</DefaultRolloverStrategy>
		</RollingFile>


		<!-- WARN / ERROR -->
		<RollingFile name="ERROR_FILE" createOnDemand="true"
			fileName="${LOG_DIR}/error/error.log" filePattern="${ERROR_PATTERN}">

			<PatternLayout
				pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %c - %msg%n" />

			<Policies>
				<SizeBasedTriggeringPolicy
					size="${MAX_SIZE}" />
			</Policies>


			<!-- WARN 이상만 통과 -->
			<Filters>
				<ThresholdFilter level="WARN" onMatch="ACCEPT"
					onMismatch="DENY" />
			</Filters>

			<DefaultRolloverStrategy fileIndex="min">
				<Delete basePath="${LOG_DIR}/error/archived" maxDepth="1">
					<IfFileName glob="error-*.log.gz" />
					<IfAccumulatedFileCount
						exceeds="${ERROR_MAX_FILES}" />
				</Delete>
			</DefaultRolloverStrategy>
		</RollingFile>
		
		<!-- AUDIT -->
		<RollingFile name="AUDIT_FILE" createOnDemand="true"
			fileName="${LOG_DIR}/audit/audit.log" filePattern="${AUDIT_PATTERN}">

			<PatternLayout
				pattern="%d{yyyy-MM-dd HH:mm:ss.SSS} [%t] %-5level %c - %msg%n" />

			<Policies>
				<SizeBasedTriggeringPolicy
					size="${MAX_SIZE}" />
			</Policies>

			<DefaultRolloverStrategy fileIndex="min">
				<Delete basePath="${LOG_DIR}/audit/archived" maxDepth="1">
					<IfFileName glob="audit-*.log.gz" />
					<IfAccumulatedFileCount
						exceeds="${AUDIT_MAX_FILES}" />
				</Delete>
			</DefaultRolloverStrategy>
		</RollingFile>
	</Appenders>

	<Loggers>
		<Root level="debug">
			<AppenderRef ref="Console" />
			<AppenderRef ref="APP_FILE" />
			<AppenderRef ref="ERROR_FILE" />
			<AppenderRef ref="AUDIT_FILE" />
		</Root>
	</Loggers>

</Configuration>
